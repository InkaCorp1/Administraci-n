<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>INKA CORP - Mï¿½vil</title>
    <meta name="description" content="Sistema de gestiï¿½n INKA CORP - Vista Mï¿½vil">
    <meta name="theme-color" content="#0B4E32">
    
    <!-- PWA Meta Tags -->
    <link rel="manifest" href="../manifest.json">
    <link rel="apple-touch-icon" href="../img/icon-192.png">
    
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- CSS Base -->
    <link rel="stylesheet" href="css/mobile-styles.css">
    
    <!-- Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
    
    <!-- Core Config/JS -->
    <script src="../js/config.js"></script>
    <script src="../js/auth.js"></script>
</head>

<body class="mobile-body">
    <!-- Splash Screen -->
    <div id="splash-screen">
        <img src="https://i.ibb.co/3mC22Hc4/inka-corp.png" alt="Logo" class="splash-logo">
        <div class="splash-spinner"></div>
    </div>

    <div class="mobile-app">
        <!-- HEADER MODULAR -->
        <header class="mobile-header">
            <div class="header-top">
                <div class="header-logo">
                    <img src="https://i.ibb.co/3mC22Hc4/inka-corp.png" alt="Logo">
                    <span class="header-logo-text">INKA CORP</span>
                </div>
                <div class="header-actions">
                    <button class="header-btn" id="refresh-btn" onclick="location.reload()">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                    <button class="header-btn" id="logout-btn" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>
            <div class="header-greeting">
                <div class="greeting-text">Bienvenido de nuevo,</div>
                <div class="greeting-name">Cargando...</div>
            </div>
        </header>

        <!-- CONTENIDO DINï¿½MICO -->
        <main class="main-content">
            <div class="loading-state">
                <div class="loading-spinner"></div>
                <p>Cargando mï¿½dulo...</p>
            </div>
        </main>

        <!-- NAVEGACIÓN INFERIOR -->
        <nav class="mobile-nav">
            <div class="nav-item active" id="nav-desembolsos" onclick="loadMobileView('desembolsos')">
                <i class="fas fa-home"></i>
                <span>Inicio</span>
            </div>
            <div class="nav-item" id="nav-creditos" onclick="loadMobileView('creditos')">
                <i class="fas fa-hand-holding-usd"></i>
                <span>Créditos</span>
            </div>
            
            <!-- Botón Central FAB -->
            <div class="nav-fab-container">
                <button class="nav-fab" onclick="toggleQuickMenu()">
                    <i class="fas fa-plus"></i>
                </button>
            </div>

            <div class="nav-item" id="nav-bancos" onclick="loadMobileView('bancos')">
                <i class="fas fa-university"></i>
                <span>Bancos</span>
            </div>
            <div class="nav-item" id="nav-simulador" onclick="loadMobileView('simulador')">
                <i class="fas fa-calculator"></i>
                <span>Simul.</span>
            </div>
        </nav>
    </div>

    <!-- Menú de Acciones Rápidas (Overlay) -->
    <div id="quick-menu-overlay" class="quick-menu-overlay" onclick="toggleQuickMenu()">
        <div class="quick-menu-content" onclick="event.stopPropagation()">
            <div class="quick-menu-header">
                <h3>Acciones Rápidas</h3>
                <button class="quick-menu-close" onclick="toggleQuickMenu()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="quick-menu-grid">
                <div class="quick-item" onclick="loadMobileView('aportes'); toggleQuickMenu()">
                    <div class="quick-icon bg-purple">
                        <i class="fas fa-piggy-bank"></i>
                    </div>
                    <span>Aportes</span>
                </div>
                <div class="quick-item" onclick="loadMobileView('desembolsos'); toggleQuickMenu()">
                    <div class="quick-icon bg-green">
                        <i class="fas fa-money-bill-wave"></i>
                    </div>
                    <span>Desembolsos</span>
                </div>
                <div class="quick-item" onclick="goToDesktopModule('dashboard'); toggleQuickMenu()">
                    <div class="quick-icon bg-gold">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <span>Reportes</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Modales Compartidos -->
    <div id="credito-lite-modal" class="modal-overlay">
        <!-- Contenido base del modal de créditos -->
        <div class="modal-content lite-modal">
            <div class="modal-header lite-header">
                <h3><i class="fas fa-file-invoice-dollar"></i> Detalle del Crédito</h3>
                <button class="modal-close" onclick="closeLiteModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body lite-body">
                <!-- Resumen Superior -->
                <div class="lite-detail-header">
                    <h4 id="lite-det-codigo">---</h4>
                    <div id="lite-det-socio" class="lite-det-socio">---</div>
                </div>

                <!-- Progreso -->
                <div class="lite-det-section">
                    <div class="lite-det-label">Progreso del Crédito</div>
                    <div class="lite-progress-container">
                        <div id="lite-progreso-bar" class="lite-progress-bar" style="width: 0%"></div>
                    </div>
                    <div class="lite-progress-info">
                        <span id="lite-det-cuotas">0/0 cuotas</span>
                        <span id="lite-det-pct">0%</span>
                    </div>
                </div>

                <!-- Valores Clave -->
                <div class="lite-det-grid">
                    <div class="lite-det-item highlight">
                        <div class="lite-det-label">Próx. Cuota</div>
                        <div id="lite-det-cuota" class="lite-det-value">$0.00</div>
                    </div>
                    <div class="lite-det-item">
                        <div class="lite-det-label">Capital</div>
                        <div id="lite-det-capital" class="lite-det-value">$0.00</div>
                    </div>
                </div>

                <!-- Información Adicional -->
                <div class="lite-det-section" style="padding: 1rem;">
                    <div class="lite-info-row">
                        <i class="fas fa-calendar-day"></i>
                        <div class="lite-info-content">
                            <div class="lite-info-label">Fecha Desembolso</div>
                            <div id="lite-det-fecha-val" class="lite-info-value">---</div>
                        </div>
                    </div>
                    <div class="lite-info-row">
                        <i class="fas fa-history"></i>
                        <div class="lite-info-content">
                            <div class="lite-info-label">Próximo Vencimiento</div>
                            <div id="lite-det-vencimiento" class="lite-info-value">---</div>
                        </div>
                    </div>
                </div>

                <!-- Acciones -->
                <div class="lite-actions-group">
                    <button class="lite-btn-action success" id="btn-pagar-credito" style="display:none;">
                        <i class="fas fa-hand-holding-usd"></i> Pagar Cuota
                    </button>
                    <button class="lite-btn-action primary" id="btn-whatsapp-socio">
                        <i class="fab fa-whatsapp"></i> Contactar Socio
                    </button>
                    <button class="lite-btn-action secondary" onclick="showCreditoAmortization()">
                        <i class="fas fa-list-ol"></i> Ver Amortización
                    </button>
                </div>

                <div class="lite-det-footer">
                    <span id="lite-det-estado" class="lite-det-status">---</span>
                    <span id="lite-det-fecha" style="display:none;">---</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Amortización Créditos -->
    <div id="modal-amortizacion-credito" class="modal-overlay">
        <div class="modal-content lite-modal">
            <div class="modal-header lite-header">
                <h3><i class="fas fa-list-ol"></i> Plan de Pagos</h3>
                <button class="modal-close" onclick="closeLiteModal('modal-amortizacion-credito')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body lite-body">
                <div class="lite-bank-info">
                    <h4 id="lite-amort-codigo">---</h4>
                    <div id="lite-amort-socio" class="lite-bank-debtor">---</div>
                </div>

                <div class="amortization-table-mobile-container">
                    <table class="amortization-table-lite">
                        <thead>
                            <tr>
                                <th style="width: 40px;">#</th>
                                <th>Vencimiento</th>
                                <th style="text-align: center;">Estado</th>
                                <th style="text-align: right;">Acción</th>
                            </tr>
                        </thead>
                        <tbody id="lite-amortization-credito-body">
                            <!-- Cuotas se cargan aquí -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Detalle de Pago Móvil -->
    <div id="modal-pago-detalle-mobile" class="modal-overlay">
        <div class="modal-content lite-modal">
            <div class="modal-header lite-header" style="background: #10b981; color: white;">
                <h3><i class="fas fa-receipt"></i> Detalle de Pago</h3>
                <button class="modal-close" onclick="closeLiteModal('modal-pago-detalle-mobile')" style="background: white; color: black; width: 30px; height: 30px; border-radius: 50%; opacity: 1; display: flex; align-items: center; justify-content: center; border: none; font-size: 14px; box-shadow: 0 2px 5px rgba(0,0,0,0.2);">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body lite-body" id="lite-pago-detalle-container">
                <!-- Se llena dinámicamente -->
                <div style="text-align: center; padding: 2rem;">
                    <i class="fas fa-spinner fa-spin"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Registro de Pago Pro (Créditos) -->
    <div id="modal-registro-pago-credito" class="modal-overlay">
        <div class="modal-content lite-modal">
            <div class="modal-header lite-header">
                <div style="display: flex; flex-direction: column;">
                    <h3 style="margin: 0;"><i class="fas fa-cash-register"></i> Registrar Pago</h3>
                    <span id="pago-lite-credito-codigo" style="font-size: 0.8rem; color: var(--text-secondary); font-weight: 500;">COD: ---</span>
                </div>
                <button class="modal-close" onclick="closeLiteModal('modal-registro-pago-credito')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body lite-body" style="padding: 1.25rem;">
                <!-- Socio Info -->
                <div style="background: #f8fafc; padding: 1rem; border-radius: 12px; margin-bottom: 1.5rem; border: 1px dashed #cbd5e1;">
                    <span style="font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px;">Socio</span>
                    <div id="pago-lite-socio-nombre" style="font-weight: 700; color: var(--text-main); font-size: 1.1rem;">-</div>
                </div>

                <!-- Selección de Cuotas -->
                <div class="lite-form-group" style="margin-bottom: 1.25rem;">
                    <label style="font-weight: 600; margin-bottom: 0.5rem; display: block; font-size: 0.85rem;">Cuotas a Cancelar</label>
                    <div style="position: relative;">
                        <select id="pago-lite-cuotas-select" class="lite-input" style="appearance: none; padding-right: 40px; border-radius: 12px; height: 50px;">
                            <!-- Opciones dinámicas -->
                        </select>
                        <i class="fas fa-chevron-down" style="position: absolute; right: 15px; top: 18px; color: var(--text-secondary); pointer-events: none;"></i>
                    </div>
                </div>

                <div class="lite-form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.25rem;">
                    <div class="lite-form-group">
                        <label style="font-weight: 600; margin-bottom: 0.5rem; display: block; font-size: 0.85rem;">Fecha Pago</label>
                        <input type="date" id="pago-lite-fecha" class="lite-input" style="border-radius: 12px; height: 50px;">
                    </div>
                    <div class="lite-form-group">
                        <label style="font-weight: 600; margin-bottom: 0.5rem; display: block; font-size: 0.85rem;">Método</label>
                        <select id="pago-lite-metodo" class="lite-input" style="border-radius: 12px; height: 50px;">
                            <option value="EFECTIVO">Efectivo</option>
                            <option value="TRANSFERENCIA">Transferencia</option>
                            <option value="DEPOSITO">Depósito</option>
                            <option value="OTROS">Otros</option>
                        </select>
                    </div>
                </div>

                <!-- Card de Resumen con Totals -->
                <div style="background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); padding: 1.5rem; border-radius: 20px; color: white; margin-bottom: 1.5rem; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.75rem; opacity: 0.8; font-size: 0.85rem;">
                        <span>Subtotal Cuotas</span>
                        <span id="pago-lite-monto-base">$0.00</span>
                    </div>
                    <div id="pago-lite-mora-row" style="display: none; justify-content: space-between; margin-bottom: 0.75rem; color: #fbbf24; font-size: 0.85rem;">
                        <span>Mora Sugerida (<span id="pago-lite-dias-mora">0</span> días)</span>
                        <span id="pago-lite-monto-mora">$0.00</span>
                    </div>
                    <div style="height: 1px; background: rgba(255,255,255,0.1); margin: 0.75rem 0;"></div>
                    <div style="display: flex; justify-content: space-between; align-items: baseline;">
                        <span style="font-weight: 600;">MONTO TOTAL</span>
                        <div style="display: flex; flex-direction: column; align-items: flex-end;">
                            <span id="pago-lite-total-final" style="font-size: 1.8rem; font-weight: 800; color: #38bdf8;">$0.00</span>
                            <label style="display: flex; align-items: center; gap: 8px; font-size: 0.75rem; color: #94a3b8; margin-top: 5px; cursor: pointer;">
                                <input type="checkbox" id="pago-lite-convenio-toggle" style="width: 16px; height: 16px; accent-color: #38bdf8;">
                                Convenio de Pago
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Monto Personalizado (Solo si hay convenio) -->
                <div id="pago-lite-monto-personalizado-container" class="lite-form-group" style="display: none; margin-bottom: 1.25rem; animation: slideDown 0.3s ease;">
                    <label style="font-weight: 600; margin-bottom: 0.5rem; display: block; font-size: 0.85rem; color: var(--primary);">Monto a Pagar por Convenio</label>
                    <div style="position: relative;">
                        <span style="position: absolute; left: 15px; top: 12px; font-weight: 700; color: var(--primary);">$</span>
                        <input type="number" id="pago-lite-monto-personalizado" class="lite-input" placeholder="0.00" step="0.01" style="padding-left: 35px; border-radius: 12px; height: 50px; border: 2px solid var(--primary);">
                    </div>
                    <p id="pago-lite-min-hint" style="font-size: 0.75rem; color: var(--primary); margin-top: 5px; font-weight: 600; display: none;">
                        <i class="fas fa-hand-holding-usd"></i> Mínimo permitido: <span id="pago-lite-min-valor">$0.00</span>
                    </p>
                </div>

                <!-- Campos Adicionales -->
                <div class="lite-form-group" style="margin-bottom: 1.25rem;">
                    <label style="font-weight: 600; margin-bottom: 0.5rem; display: block; font-size: 0.85rem;">Referencia / Comprobante # <span style="color: #ef4444;">*</span></label>
                    <input type="text" id="pago-lite-referencia" class="lite-input" placeholder="Ej: Transf. 12345" style="border-radius: 12px; height: 50px;">
                </div>

                <!-- Subida de Comprobante -->
                <div style="margin-bottom: 2rem;">
                    <label style="font-weight: 600; margin-bottom: 0.5rem; display: block; font-size: 0.85rem;">Evidencia de Pago (Foto) <span style="color: #ef4444;">*</span></label>
                    <div id="pago-lite-upload-container" style="position: relative; height: 160px; border: 2px dashed #cbd5e1; border-radius: 20px; display: flex; flex-direction: column; align-items: center; justify-content: center; background: #f8fafc; overflow: hidden;">
                        <input type="file" id="pago-lite-file-input" accept="image/*" capture="environment" style="position: absolute; width: 100%; height: 100%; opacity: 0; cursor: pointer; z-index: 2;">
                        
                        <!-- Preview (inicialmente oculto) -->
                        <img id="pago-lite-preview" style="display: none; width: 100%; height: 100%; object-fit: cover; position: absolute; top: 0; left: 0;">
                        
                        <div id="pago-lite-upload-placeholder" style="text-align: center;">
                            <i class="fas fa-camera" style="font-size: 2rem; color: var(--primary); margin-bottom: 8px;"></i>
                            <p style="font-size: 0.8rem; color: var(--text-secondary); margin: 0;">Presiona para tomar foto</p>
                        </div>

                        <button id="pago-lite-remove-file" type="button" onclick="window.clearLiteReceipt()" style="display: none; position: absolute; top: 10px; right: 10px; background: rgba(220, 38, 38, 0.9); color: white; border: none; width: 32px; height: 32px; border-radius: 50%; z-index: 3;">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>

                <div style="margin-bottom: 2rem;">
                    <button id="btn-lite-confirmar-pago" class="lite-btn-primary" style="width: 100%; height: 60px; font-size: 1.1rem; border-radius: 30px; box-shadow: 0 4px 12px rgba(30, 64, 175, 0.3);">
                        <i class="fas fa-check-circle"></i> Confirmar y Registrar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Botón Volver Arriba -->
    <button id="scroll-to-top" class="scroll-top-btn" onclick="scrollToTop()">
        <i class="fas fa-chevron-up"></i>
    </button>

    <!-- Tools & Utils -->
    <script src="../js/config.js"></script>
    <script src="../js/image-utils.js"></script>
    <script src="js/mobile-app.js"></script>

    <script>
        async function logout() {
            const { error } = await window.getSupabaseClient().auth.signOut();
            if (error) console.error(error);
            window.location.href = '../login.html';
        }
    </script>
</body>

</html>



